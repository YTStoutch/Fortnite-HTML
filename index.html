<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mini-Fortnite Multijoueur</title>
<style>body{margin:0;overflow:hidden;}canvas{display:block;}</style>
<script src="https://unpkg.com/three@0.152.0/build/three.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
</head>
<body>
<script>
// Socket.io
const socket = io();

// Joueur local
let player = {x:0,y:0,z:0,rotationY:0};
let allPlayers = {};

// Recevoir positions des joueurs
socket.on('playersUpdate', data => { allPlayers = data; });

// Envoi régulier de la position locale
setInterval(() => { socket.emit('updatePosition', player); }, 50);

// === Exemple minimal avec Three.js ===
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lumière et sol
const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(10,20,10);
scene.add(light);
const ground = new THREE.Mesh(new THREE.PlaneGeometry(500,500), new THREE.MeshPhongMaterial({color:0x228B22}));
ground.rotation.x=-Math.PI/2; scene.add(ground);

// Joueur local
const playerGeo = new THREE.BoxGeometry(1,2,1);
const playerMat = new THREE.MeshPhongMaterial({color:0xff0000});
const playerMesh = new THREE.Mesh(playerGeo, playerMat);
playerMesh.position.y=1;
scene.add(playerMesh);

// Boucle d’animation
camera.position.set(0,5,10);
function animate(){
  requestAnimationFrame(animate);

  // Mettre à jour la position du cube joueur
  playerMesh.position.set(player.x, player.y, player.z);

  // Afficher les autres joueurs
  for(let id in allPlayers){
    if(id === socket.id) continue; // ignore toi-même
    let p = allPlayers[id];
    if(!scene.getObjectByName(id)){
      const otherGeo = new THREE.BoxGeometry(1,2,1);
      const otherMat = new THREE.MeshPhongMaterial({color:0x00ff00});
      const otherMesh = new THREE.Mesh(otherGeo, otherMat);
      otherMesh.name = id;
      otherMesh.position.set(p.x, p.y, p.z);
      scene.add(otherMesh);
    } else {
      scene.getObjectByName(id).position.set(p.x,p.y,p.z);
    }
  }

  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
